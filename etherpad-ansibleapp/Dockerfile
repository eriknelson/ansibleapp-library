FROM ansibleapp/ansibleapp-base
# MAINTAINER {{ $MAINTAINER }}

LABEL "com.redhat.ansibleapp.version"="0.1.0"
LABEL "com.redhat.ansibleapp.spec"=\
"aWQ6IGYzMmRlM2JjLTMyMjUtNDI5YS1iMjNiLWNlZjQ3Y2ExZDI1YgpuYW1lOiBhbnNpYmxlYXBw\
L2V0aGVycGFkLWFuc2libGVhcHAKZGVzY3JpcHRpb246IE5vdGUgdGFraW5nIHdlYiBhcHBsaWNh\
dGlvbgpiaW5kYWJsZTogdHJ1ZQphc3luYzogIm9wdGlvbmFsIgpwYXJhbWV0ZXJzOgogIC0gbmFt\
ZTogaG9zdHBvcnQKICAgIGRlc2NyaXB0aW9uOiBUaGUgaG9zdCBUQ1AgcG9ydCBhcyB0aGUgZXh0\
ZXJuYWwgZW5kcG9pbnQKICAgIGRlZmF1bHQ6IDkwMDEKICAtIG5hbWU6IGRiX3VzZXIKICAgIGRl\
c2NyaXB0aW9uOiBEYXRhYmFzZSBVc2VyCiAgLSBuYW1lOiBkYl9wYXNzCiAgICBkZXNjcmlwdGlv\
bjogRGF0YWJhc2UgUGFzc3dvcmQKICAtIG5hbWU6IGRiX25hbWUKICAgIGRlc2NyaXB0aW9uOiBE\
YXRhYmFzZSBOYW1lCiAgLSBuYW1lOiBkYl9ob3N0CiAgICBkZXNjcmlwdGlvbjogRGF0YWJhc2Ug\
c2VydmljZSBob3N0bmFtZS9pcAogICAgZGVmYXVsdDogbWFyaWFkYgogIC0gbmFtZTogZGJfcG9y\
dAogICAgZGVzY3JpcHRpb246IERhdGFiYXNlIHNlcnZpY2UgcG9ydAo="
ADD ansible /opt/ansible
ADD ansibleapp /opt/ansibleapp

RUN useradd -u 1001 -r -g 0 -M -b /opt/ansibleapp -s /sbin/nologin -c "ansibleapp user" ansibleapp

# Fixup all the directories under the account so they are group writable
# to the 'root' group (gid=0) so they can be updated if necessary, such
# as would occur if using 'oc rsync' to copy files into a container.

RUN chown -R 1001:0 /opt/{ansible,ansibleapp}
USER 1001
